<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.test.mybatis.IUserDAO">

	<!-- 회원가입 하는 인설트 구문.  -->
   <insert id="userinsert" statementType="CALLABLE">
   
	call PRC_USER_INSERT(#{user_id},#{user_pw},#{user_name},#{user_post_num},#{user_addr},#{user_detail_addr},#{user_tel},#{bank_code},#{account_num})

   </insert>
   
   
   <!-- 현재 가입중인 회원번호 조회하기.  -->
   <select id="searchCode" resultType="java.lang.Integer">
   
	SELECT MAX(USER_CODE)
	FROM TBL_USER_BACKUP
   </select>
   
   <!-- 로그인 시, 일치하는 회원있는지 조회하기.  -->
   <select id="logincheck" resultType="java.lang.Integer"> 
	   	
	SELECT COUNT(*)
	FROM TBL_USER
	WHERE USER_ID=#{user_id, jdbcType=VARCHAR} AND USER_PW=CRYPTPACK.ENCRYPT (#{user_pw}, #{user_pw})
   
   </select>
   
   <!-- 회원코드 넘겨줬을 때, 회원명 받아오기.  -->
   <select id="searchName" resultType="java.lang.String">
    SELECT USER_NAME
   	FROM TBL_USER
   	WHERE USER_CODE=#{user_code}
   </select>
   
   <!--회원아이디 줬을 때, 회원코드 반환하기   -->
   <select id="code" resultType="java.lang.Integer">
   
   SELECT USER_CODE
   FROM TBL_USER
   WHERE USER_ID=#{user_id, jdbcType=VARCHAR}
   
   </select>
   
   <!-- 아이디 찾을 때, 이름 + 전화번호 넘기면 코드 반환.  -->
   <select id="checkId" resultType="java.lang.Integer">
	SELECT USER_CODE
	FROM TBL_USER
	WHERE USER_TEL=#{user_tel, jdbcType=VARCHAR } AND USER_NAME=#{user_name, jdbcType=VARCHAR} 
   </select>
   
   <!-- 아이디 찾을 때, 이름 + 전화번호 넘기면 유저디티오 필요한것들 반환  -->
   <select id="lists" resultType="com.test.mybatis.UserDTO">
   
    SELECT USER_CODE, USER_NAME, USER_ID, SIGNUP_D
	FROM TBL_USER
	WHERE USER_TEL=#{user_tel, jdbcType=VARCHAR } AND USER_NAME=#{user_name, jdbcType=VARCHAR} 
   </select>
   
   <!-- 회원코드로 전체 정보 가져오기. -->
   <select id="getInfo" resultType="com.test.mybatis.UserDTO">
   
  	SELECT USER_CODE, USER_ID, USER_PW, USER_NAME, USER_ADDR, USER_DETAIL_ADDR, USER_TEL, ACCOUNT_NUM, USER_POST_NUM, BANK_CODE, SIGNUP_D
   	FROM TBL_USER
   	WHERE USER_CODE=#{user_code, jdbcType=NUMERIC}
 
   
   </select>
   
   <!-- 비밀번호 찾을 때, 아이디 + 전화번호 넘기면 유저DTO 반환.  -->
   <select id="pwlists" resultType="com.test.mybatis.UserDTO">
   
    SELECT USER_CODE, USER_NAME, USER_ID, SIGNUP_D
	FROM TBL_USER
	WHERE USER_TEL=#{user_tel, jdbcType=VARCHAR } AND USER_ID =#{user_id, jdbcType=VARCHAR} 
   </select>
   
   
   <update id="pwchange">
	   
	UPDATE TBL_USER
	SET USER_PW=#{user_pw, jdbcType=VARCHAR}
	WHERE USER_CODE=#{user_code, jdbcType=NUMERIC}
	   
   
   </update>
   
</mapper>









